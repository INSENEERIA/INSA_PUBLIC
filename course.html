<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">INSA - Kursus</title>
    <link rel="stylesheet" href="css.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="course-page">
<div class="container">
    <div class="header">
        <a href="index.html" class="back-link">
            <i class="fa fa-arrow-left"></i> Tagasi
        </a>
        <h1 id="course-title">Laeb...</h1>
        <p id="course-subtitle"></p>
    </div>

    <div class="content" id="course-content">
        <div class="loading">
            <i class="fa fa-spinner fa-spin"></i>
            <p>Laeb kursuse sisu...</p>
        </div>
    </div>

    <div class="quick-links" id="quick-links" style="display: none;">
        <h3><i class="fa fa-link"></i> Kiired lingid</h3>
        <div class="button-group" id="button-group"></div>
    </div>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get('id') || 'engineering';

    async function loadCourse() {
        try {
            const response = await fetch('courses.json');
            const courses = await response.json();
            const course = courses[courseId];

            if (!course) {
                showError('Kursust ei leitud! Kontrollige URL-i parameetrit.');
                return;
            }

            renderCourse(course);
        } catch (error) {
            showError('Viga kursuse laadimisel: ' + error.message);
        }
    }

    function showError(message) {
        document.getElementById('course-title').textContent = 'Viga';
        document.getElementById('course-subtitle').textContent = '';
        document.getElementById('course-content').innerHTML = `
            <div class="error-message">
                <strong><i class="fa fa-exclamation-triangle"></i> ${message}</strong>
                <p style="margin-top: 10px;">Tagasi <a href="index.html">avalehele</a></p>
            </div>
        `;
    }

    function renderCourse(course) {
        document.getElementById('page-title').textContent = `INSA - ${course.title}`;
        document.getElementById('course-title').textContent = course.title;
        document.getElementById('course-subtitle').textContent = course.subtitle;

        const content = document.getElementById('course-content');
        content.innerHTML = '';

        course.modules.forEach(module => {
            const moduleDiv = document.createElement('div');
            moduleDiv.className = 'module';

            const moduleHeader = document.createElement('div');
            moduleHeader.className = 'module-header';
            moduleHeader.innerHTML = `
                <i class="fa ${module.icon}"></i> ${module.id}. ${module.title}
            `;

            const moduleContent = document.createElement('div');
            moduleContent.className = 'module-content';

            const taskList = document.createElement('ul');
            taskList.className = 'task-list';

            module.tasks.forEach(task => {
                const li = document.createElement('li');
                if (task.graded) li.classList.add('graded-task');
                if (task.indent) li.classList.add('indent');

                let taskHTML = task.text;

                // Single link
                if (task.link) {
                    const linkClass = task.linkType === 'youtube' ? 'youtube-link' :
                        task.linkType === 'drive' ? 'drive-link' : 'task-link';
                    taskHTML = `<a href="${task.link}" class="${linkClass}" target="_blank">${task.text}</a>`;
                }

                // Multiple links
                if (task.links) {
                    task.links.forEach(link => {
                        const linkClass = link.type === 'youtube' ? 'youtube-link' :
                            link.type === 'drive' ? 'drive-link' : 'task-link';
                        taskHTML += ` <a href="${link.url}" class="${linkClass}" target="_blank">${link.text}</a>`;
                    });
                }

                li.innerHTML = taskHTML;

                if (task.graded) {
                    const badge = document.createElement('span');
                    badge.className = 'graded-badge';
                    badge.textContent = 'HINDELINE';
                    li.appendChild(badge);
                }

                taskList.appendChild(li);
            });

            moduleContent.appendChild(taskList);
            moduleDiv.appendChild(moduleHeader);
            moduleDiv.appendChild(moduleContent);
            content.appendChild(moduleDiv);
        });

        renderQuickLinks(course);
    }

    function renderQuickLinks(course) {
        const quickLinks = document.getElementById('quick-links');
        const buttonGroup = document.getElementById('button-group');

        buttonGroup.innerHTML = '';

        if (course.youtubeChannel) {
            buttonGroup.innerHTML += `
                <a href="${course.youtubeChannel}" class="btn btn-youtube" target="_blank">
                    <i class="fa fa-youtube-play"></i> YouTube kanal
                </a>
            `;
        }

        if (course.driveFolder) {
            buttonGroup.innerHTML += `
                <a href="${course.driveFolder}" class="btn btn-drive" target="_blank">
                    <i class="fa fa-google"></i> Google Drive
                </a>
            `;
        }

        buttonGroup.innerHTML += `
            <a href="https://youtube.com/@laurisoosaar?si=NwqPogw68JmPygsq" class="btn btn-youtube">
                <i class="fa fa-youtube-play"></i> YouTube kanal
            </a>
            <a href="" class="btn btn-drive">
                <i class="fa fa-google"></i> Google Drive
            </a>
            <a href="index.html" class="btn btn-back">
                <i class="fa fa-home"></i> Tagasi avalehele
            </a>
        `;

        quickLinks.style.display = 'block';
    }

    loadCourse();
</script>
</body>
</html>